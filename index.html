<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistem Stok Barang UMKM</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary-color: #4e73df;
      --secondary-color: #858796;
      --success-color: #1cc88a;
      --danger-color: #e74a3b;
      --warning-color: #f6c23e;
    }
    
    body {
      background-color: #f8f9fc;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .navbar-custom {
      background-color: var(--primary-color);
    }
    
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      background-color: #f8f9fc;
      border-bottom: 1px solid #e3e6f0;
      padding: 1rem 1.35rem;
      font-weight: 700;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
      background-color: #3a5fc8;
      border-color: #3a5fc8;
    }
    
    .low-stock {
      color: var(--danger-color);
      font-weight: bold;
    }
    
    .medium-stock {
      color: var(--warning-color);
      font-weight: bold;
    }
    
    .action-buttons {
      white-space: nowrap;
    }
    
    .search-container {
      max-width: 300px;
    }
    
    .stat-card {
      border-left: 4px solid;
    }
    
    .stat-card.primary {
      border-left-color: var(--primary-color);
    }
    
    .stat-card.success {
      border-left-color: var(--success-color);
    }
    
    .stat-card.warning {
      border-left-color: var(--warning-color);
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom mb-4">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fas fa-store me-2"></i>Sistem Stok UMKM
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#"Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#tambahBarangModal">Tambah Barang</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Statistik -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stat-card primary h-100">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Barang</div>
                <div class="h5 mb-0 fw-bold text-gray-800" id="totalBarang">0</div>
              </div>
              <div class="col-auto">
                <i class="fas fa-boxes fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stat-card success h-100">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <div class="text-xs fw-bold text-success text-uppercase mb-1">Stok Baik</div>
                <div class="h5 mb-0 fw-bold text-gray-800" id="stokBaik">0</div>
              </div>
              <div class="col-auto">
                <i class="fas fa-check-circle fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stat-card warning h-100">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <div class="text-xs fw-bold text-warning text-uppercase mb-1">Stok Menipis</div>
                <div class="h5 mb-0 fw-bold text-gray-800" id="stokMenipis">0</div>
              </div>
              <div class="col-auto">
                <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stat-card danger h-100">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col">
                <div class="text-xs fw-bold text-danger text-uppercase mb-1">Stok Habis</div>
                <div class="h5 mb-0 fw-bold text-gray-800" id="stokHabis">0</div>
              </div>
              <div class="col-auto">
                <i class="fas fa-times-circle fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Daftar Barang -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="m-0 fw-bold">Daftar Stok Barang</h6>
            <div class="search-container">
              <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="Cari barang...">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead class="table-light">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nama Barang</th>
                    <th scope="col">Kategori</th>
                    <th scope="col">Stok</th>
                    <th scope="col">Harga (Rp)</th>
                    <th scope="col">Deskripsi</th>
                    <th scope="col">Aksi</th>
                  </tr>
                </thead>
                <tbody id="daftarBarang">
                  <!-- Data akan diisi oleh JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Tambah Barang -->
  <div class="modal fade" id="tambahBarangModal" tabindex="-1" aria-labelledby="tambahBarangModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tambahBarangModalLabel">Tambah Barang Baru</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="formTambahBarang">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="namaBarang" class="form-label">Nama Barang *</label>
                <input type="text" class="form-control" id="namaBarang" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="kategoriBarang" class="form-label">Kategori *</label>
                <select class="form-select" id="kategoriBarang" required>
                  <option value="" selected disabled>Pilih kategori</option>
                  <option value="Makanan">Makanan</option>
                  <option value="Minuman">Minuman</option>
                  <option value="Pakaian">Pakaian</option>
                  <option value="Elektronik">Elektronik</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="stokBarang" class="form-label">Stok *</label>
                <input type="number" class="form-control" id="stokBarang" min="0" required>
              </div>
              <div class="col-md-4 mb-3">
                <label for="minimalStok" class="form-label">Stok Minimal *</label>
                <input type="number" class="form-control" id="minimalStok" min="1" value="5" required>
              </div>
              <div class="col-md-4 mb-3">
                <label for="hargaBarang" class="form-label">Harga (Rp) *</label>
                <input type="number" class="form-control" id="hargaBarang" min="0" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="deskripsiBarang" class="form-label">Deskripsi</label>
              <textarea class="form-control" id="deskripsiBarang" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" id="simpanBarang">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Edit Barang -->
  <div class="modal fade" id="editBarangModal" tabindex="-1" aria-labelledby="editBarangModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editBarangModalLabel">Edit Barang</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="formEditBarang">
            <input type="hidden" id="editId">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="editNamaBarang" class="form-label">Nama Barang *</label>
                <input type="text" class="form-control" id="editNamaBarang" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="editKategoriBarang" class="form-label">Kategori *</label>
                <select class="form-select" id="editKategoriBarang" required>
                  <option value="Makanan">Makanan</option>
                  <option value="Minuman">Minuman</option>
                  <option value="Pakaian">Pakaian</option>
                  <option value="Elektronik">Elektronik</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="editStokBarang" class="form-label">Stok *</label>
                <input type="number" class="form-control" id="editStokBarang" min="0" required>
              </div>
              <div class="col-md-4 mb-3">
                <label for="editMinimalStok" class="form-label">Stok Minimal *</label>
                <input type="number" class="form-control" id="editMinimalStok" min="1" required>
              </div>
              <div class="col-md-4 mb-3">
                <label for="editHargaBarang" class="form-label">Harga (Rp) *</label>
                <input type="number" class="form-control" id="editHargaBarang" min="0" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="editDeskripsiBarang" class="form-label">Deskripsi</label>
              <textarea class="form-control" id="editDeskripsiBarang" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" id="updateBarang">Perbarui</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap & jQuery JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <!-- Firebase App (wajib) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Konfigurasi Firebase - GANTI DENGAN KONFIGURASI ANDA
    const firebaseConfig = {
      apiKey: "AIzaSyDmI0zRauvzaL4oEuXinkmXhGiwTsYxYQc",
  authDomain: "insan-cemerlang-ee7af.firebaseapp.com",
  projectId: "insan-cemerlang-ee7af",
  storageBucket: "insan-cemerlang-ee7af.firebasestorage.app",
  messagingSenderId: "1047091827759",
  appId: "1:1047091827759:web:0f1742d6f3922f856de2da",
  measurementId: "G-GL8J5GC8XB"
};

    // Inisialisasi Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Fungsi untuk mendapatkan daftar barang
    function ambilDaftarBarang() {
      return db.collection("barang").get().then((querySnapshot) => {
        const barang = [];
        querySnapshot.forEach((doc) => {
          barang.push({ id: doc.id, ...doc.data() });
        });
        return barang;
      });
    }

    // Fungsi untuk menambah barang
    function tambahBarang(barang) {
      return db.collection("barang").add(barang);
    }

    // Fungsi untuk mengubah barang
    function ubahBarang(id, barang) {
      return db.collection("barang").doc(id).update(barang);
    }

    // Fungsi untuk menghapus barang
    function hapusBarang(id) {
      return db.collection("barang").doc(id).delete();
    }

    // Fungsi untuk menampilkan daftar barang
    function tampilkanDaftarBarang() {
      ambilDaftarBarang().then(daftarBarang => {
        const elemenDaftarBarang = $("#daftarBarang");
        elemenDaftarBarang.empty();
        
        // Hitung statistik
        let totalBarang = daftarBarang.length;
        let stokBaik = 0;
        let stokMenipis = 0;
        let stokHabis = 0;
        
        let nomor = 1;
        daftarBarang.forEach((data) => {
          // Tentukan kelas stok berdasarkan jumlah
          let stokClass = "";
          let stokText = data.stok;
          
          if (data.stok === 0) {
            stokClass = "low-stock";
            stokText = "HABIS";
            stokHabis++;
          } else if (data.stok < data.minimalStok) {
            stokClass = "medium-stock";
            stokText = data.stok + " (Menipis)";
            stokMenipis++;
          } else {
            stokBaik++;
          }
          
          elemenDaftarBarang.append(
            "<tr>" +
            "<td>" + nomor + "</td>" +
            "<td>" + data.nama + "</td>" +
            "<td>" + data.kategori + "</td>" +
            "<td class='" + stokClass + "'>" + stokText + "</td>" +
            "<td>" + new Intl.NumberFormat('id-ID').format(data.harga) + "</td>" +
            "<td>" + (data.deskripsi || "-") + "</td>" +
            "<td class='action-buttons'>" + 
            "<button class='btn btn-sm btn-warning me-1 btn-ubah' data-id='" + data.id + "'><i class='fas fa-edit'></i></button>" +
            "<button class='btn btn-sm btn-danger btn-hapus' data-id='" + data.id + "'><i class='fas fa-trash'></i></button>" +
            "</td>" +
            "</tr>"
          );
          nomor++;
        });
        
        // Update statistik
        $("#totalBarang").text(totalBarang);
        $("#stokBaik").text(stokBaik);
        $("#stokMenipis").text(stokMenipis);
        $("#stokHabis").text(stokHabis);
        
        // Tambahkan event listener untuk tombol ubah
        $(".btn-ubah").click(function() {
          const id = $(this).data('id');
          bukaModalEdit(id);
        });
        
        // Tambahkan event listener untuk tombol hapus
        $(".btn-hapus").click(function() {
          const id = $(this).data('id');
          hapusDataBarang(id);
        });
      }).catch(error => {
        console.error("Error mengambil data: ", error);
        alert("Terjadi kesalahan saat mengambil data barang.");
      });
    }

    // Fungsi untuk membuka modal edit
    function bukaModalEdit(id) {
      db.collection("barang").doc(id).get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          $("#editId").val(id);
          $("#editNamaBarang").val(data.nama);
          $("#editKategoriBarang").val(data.kategori);
          $("#editStokBarang").val(data.stok);
          $("#editMinimalStok").val(data.minimalStok);
          $("#editHargaBarang").val(data.harga);
          $("#editDeskripsiBarang").val(data.deskripsi || "");
          
          // Tampilkan modal edit
          const modal = new bootstrap.Modal(document.getElementById('editBarangModal'));
          modal.show();
        } else {
          alert("Data barang tidak ditemukan!");
        }
      }).catch((error) => {
        console.error("Error mengambil data barang: ", error);
        alert("Terjadi kesalahan saat mengambil data barang.");
      });
    }

    // Fungsi untuk menghapus data barang
    function hapusDataBarang(id) {
      if (confirm("Apakah Anda yakin ingin menghapus barang ini?")) {
        hapusBarang(id).then(() => {
          alert("Barang berhasil dihapus!");
          tampilkanDaftarBarang();
        }).catch((error) => {
          console.error("Error menghapus barang: ", error);
          alert("Terjadi kesalahan saat menghapus barang.");
        });
      }
    }

    // Event listener ketika dokumen siap
    $(document).ready(function() {
      // Tampilkan daftar barang saat halaman dimuat
      tampilkanDaftarBarang();
      
      // Event listener untuk tombol simpan barang
      $("#simpanBarang").click(function() {
        const nama = $("#namaBarang").val();
        const kategori = $("#kategoriBarang").val();
        const stok = parseInt($("#stokBarang").val());
        const minimalStok = parseInt($("#minimalStok").val());
        const harga = parseInt($("#hargaBarang").val());
        const deskripsi = $("#deskripsiBarang").val();
        
        if (!nama || !kategori || isNaN(stok) || isNaN(minimalStok) || isNaN(harga)) {
          alert("Harap isi semua field yang wajib diisi!");
          return;
        }
        
        const barang = {
          nama: nama,
          kategori: kategori,
          stok: stok,
          minimalStok: minimalStok,
          harga: harga,
          deskripsi: deskripsi,
          tanggalDitambah: new Date()
        };
        
        tambahBarang(barang).then(() => {
          alert("Barang berhasil ditambahkan!");
          $("#tambahBarangModal").modal("hide");
          $("#formTambahBarang")[0].reset();
          tampilkanDaftarBarang();
        }).catch((error) => {
          console.error("Error menambahkan barang: ", error);
          alert("Terjadi kesalahan saat menambahkan barang.");
        });
      });
      
      // Event listener untuk tombol update barang
      $("#updateBarang").click(function() {
        const id = $("#editId").val();
        const nama = $("#editNamaBarang").val();
        const kategori = $("#editKategoriBarang").val();
        const stok = parseInt($("#editStokBarang").val());
        const minimalStok = parseInt($("#editMinimalStok").val());
        const harga = parseInt($("#editHargaBarang").val());
        const deskripsi = $("#editDeskripsiBarang").val();
        
        if (!nama || !kategori || isNaN(stok) || isNaN(minimalStok) || isNaN(harga)) {
          alert("Harap isi semua field yang wajib diisi!");
          return;
        }
        
        const barang = {
          nama: nama,
          kategori: kategori,
          stok: stok,
          minimalStok: minimalStok,
          harga: harga,
          deskripsi: deskripsi
        };
        
        ubahBarang(id, barang).then(() => {
          alert("Barang berhasil diperbarui!");
          $("#editBarangModal").modal("hide");
          tampilkanDaftarBarang();
        }).catch((error) => {
          console.error("Error memperbarui barang: ", error);
          alert("Terjadi kesalahan saat memperbarui barang.");
        });
      });
      
      // Event listener untuk pencarian
      $("#searchButton").click(function() {
        const searchTerm = $("#searchInput").val().toLowerCase();
        filterBarang(searchTerm);
      });
      
      $("#searchInput").on("keyup", function() {
        const searchTerm = $(this).val().toLowerCase();
        filterBarang(searchTerm);
      });
    });
    
    // Fungsi untuk memfilter barang berdasarkan pencarian
    function filterBarang(searchTerm) {
      const rows = $("#daftarBarang tr");
      
      rows.each(function() {
        const nama = $(this).find("td:eq(1)").text().toLowerCase();
        const kategori = $(this).find("td:eq(2)").text().toLowerCase();
        
        if (nama.includes(searchTerm) || kategori.includes(searchTerm)) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    }
  </script>
</body>

</html>
